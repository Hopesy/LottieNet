# 需求文档

## 项目概述
LottieNet 是一个用于 WPF 的 Lottie 动画库，提供高性能的动画渲染能力。

## 功能需求

### 核心功能

- [x] REQ-001: 基础 Lottie 控件架构
  - 优先级: 高
  - 状态: 已完成
  - 描述: 实现统一的 LottieView 控件，支持动态和预渲染两种模式
  - 验收标准:
    - [x] 支持通过 RenderMode 属性切换渲染模式
    - [x] 统一的依赖属性接口（FileName, IsPlaying, Fps, RepeatCount, Repeat）
    - [x] 自动属性同步机制

- [x] REQ-002: 动态渲染模式
  - 优先级: 高
  - 状态: 已完成
  - 描述: 实现基于 SKElement 的实时渲染
  - 验收标准:
    - [x] 使用 SkiaSharp.Skottie 实时渲染每一帧
    - [x] 支持可见性优化（不可见时停止渲染）
    - [x] 支持自定义帧率
    - [x] 支持循环播放和有限次数重复

- [x] REQ-003: 预渲染模式
  - 优先级: 高
  - 状态: 已完成
  - 描述: 实现基于图片序列的预渲染播放
  - 验收标准:
    - [x] 启动时预渲染所有帧到内存
    - [x] 使用 Image 控件显示帧序列
    - [x] 完全避免 SKElement 的 InvalidateVisual 问题
    - [x] 支持循环播放

- [ ] REQ-004: Reverse 重复模式实现
  - 优先级: 中
  - 预计时间: 1天
  - 状态: 待开发
  - 描述: 实现 RepeatMode.Reverse 反向播放功能
  - 验收标准:
    - [ ] DynamicLottieView 支持反向时间轴播放
    - [ ] PrerenderedLottieView 支持反向遍历帧序列
    - [ ] 动画在正向和反向之间平滑过渡

### 性能需求

- [ ] REQ-005: 性能优化
  - 优先级: 中
  - 预计时间: 2天
  - 状态: 待开发
  - 描述: 优化内存占用和 CPU 使用率
  - 验收标准:
    - [ ] PrerenderedLottieView 支持帧压缩或按需加载
    - [ ] DynamicLottieView 支持自适应帧率
    - [ ] 内存占用在合理范围内（<100MB for 5s 30fps 动画）

- [ ] REQ-006: 异步加载
  - 优先级: 中
  - 预计时间: 1天
  - 状态: 待开发
  - 描述: 支持异步加载和预渲染，避免阻塞 UI 线程
  - 验收标准:
    - [ ] 文件读取异步化
    - [ ] 预渲染过程异步化
    - [ ] 提供加载进度事件

### 功能增强

- [ ] REQ-007: 动画控制 API
  - 优先级: 低
  - 预计时间: 2天
  - 状态: 待规划
  - 描述: 提供更丰富的动画控制能力
  - 验收标准:
    - [ ] 支持暂停/恢复
    - [ ] 支持跳转到指定帧
    - [ ] 支持播放速度调节
    - [ ] 提供播放完成事件

- [ ] REQ-008: 资源管理
  - 优先级: 低
  - 预计时间: 1天
  - 状态: 待规划
  - 描述: 改进资源释放和内存管理
  - 验证标准:
    - [ ] 正确实现 IDisposable 模式
    - [ ] 自动清理未使用的帧缓存
    - [ ] 支持控件卸载时释放资源

- [ ] REQ-009: 示例应用完善
  - 优先级: 低
  - 预计时间: 1天
  - 状态: 待规划
  - 描述: 完善 Samples 项目，展示各种使用场景
  - 验收标准:
    - [ ] 展示两种渲染模式的对比
    - [ ] 展示不同配置参数的效果
    - [ ] 提供性能监控界面

### 文档与测试

- [ ] REQ-010: 单元测试
  - 优先级: 中
  - 预计时间: 3天
  - 状态: 待开发
  - 描述: 为核心功能添加单元测试
  - 验收标准:
    - [ ] 测试覆盖率 > 70%
    - [ ] 包含属性同步机制的测试
    - [ ] 包含渲染模式切换的测试

- [ ] REQ-011: API 文档
  - 优先级: 低
  - 预计时间: 2天
  - 状态: 待规划
  - 描述: 完善 XML 注释和使用文档
  - 验收标准:
    - [ ] 所有公共 API 都有 XML 注释
    - [ ] 提供快速入门指南
    - [ ] 提供最佳实践建议

## 非功能需求

### 兼容性
- 目标框架: .NET 8 Windows
- 最低 Windows 版本: Windows 10

### 依赖项
- SkiaSharp.Skottie >= 3.119.1
- SkiaSharp.Views.WPF >= 3.119.1

### 发布要求
- 支持 NuGet 包发布
- 遵循语义化版本控制
